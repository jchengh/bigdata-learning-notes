





# MySQL 主从故障切换操作文档

## 1. 目的

​    本文档旨在指导数据库管理员在MySQL主服务器（172.22.0.40）发生故障时，如何安全、迅速地将从服务器（172.22.0.58）提升为新的主服务器，以最小化服务中断时间并确保数据的完整性。

## 2. 前提条件

- 主从复制配置已正确设置，并且从服务器（172.22.0.58）正在实时同步主服务器（172.22.0.40）的数据。
- 所有从服务器均已配置为只读模式，以防止数据不一致。

## 3. 执行故障切换

### 3.1 停止复制进程

1. 登录到所选的从服务器（172.22.0.58）。

2. 停止复制进程以防止新的数据差异：

   ```sql
   STOP SLAVE;
   ```

### 3.2 切换角色

1. 将从服务器（172.22.0.58）设置为可写模式：

```sql
SET GLOBAL read_only = OFF;
```

2. 确认从服务器（172.22.0.58）已成功切换为可写模式。

### 3.3 重新配置复制

1. 将其他从服务器配置为从新的主服务器（172.22.0.58）复制数据：

```
CHANGE MASTER TO MASTER_HOST='172.22.0.58', 
MASTER_USER='replication_user', 
MASTER_PASSWORD='replication_password', 
MASTER_LOG_FILE='log_file_name', 
MASTER_LOG_POS=log_position;
START SLAVE;
```

### 3.4 验证切换

1. 验证新的主服务器（172.22.0.58）是否能够正常处理读写请求。

### 3.5 故障恢复

查看服务器（172.22.0.40）的日志，解决并重启mysql，将其加入mysql集群并设置成Slave。













